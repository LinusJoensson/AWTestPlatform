@model ViewQuestionVM

<script>
    app.controller('questionController', ['$scope', '$timeout', '$interval', function ($scope, $timeout, $interval) {
        $scope.counter = @*@Model.TimeLeft*@ 3;
        var counting;
        $scope.timeOutMessage = "Your time is up!";
        $scope.isTimeUp = false;
        $scope.countdown = function () {
            counting = $timeout(function () {
                console.log($scope.counter);
                if ($scope.counter === 0) {
                    $scope.isTimeUp = true;
                    $interval.cancel(stop);
                }
                else {
                    $scope.counter--;
                    $scope.countdown();
                }
            }, 1000);
        };

    }]);
</script>

<div ng-controller="questionController" ng-init="countdown();">
    <h1>@Model.TestTitle</h1>
    <h2>@Model.QuestionIndex / @Model.NumOfQuestion</h2>
    <h2>Time left: {{counter}}</h2>
    <hr />
    @{
        var progressBarProcent = Math.Floor(((double)Model.QuestionIndex / Model.NumOfQuestion) * 100);
    }
    <div>

        <div class="progress">

            <div class="progress-bar" role="progressbar" aria-valuenow="@progressBarProcent"
                 aria-valuemin="0" aria-valuemax="100" style="width:@($"{progressBarProcent}%")">
                @Model.QuestionIndex of @Model.NumOfQuestion questions
            </div>

        </div>

        <form asp-controller="TestSession" asp-action="ViewQuestion">

            @Html.Partial("_QuestionFormPartial", Model.QuestionFormVM)

            <div ng-show="isTimeUp">
                <h2 class="red">{{timeOutMessage}}</h2>
            </div>

            @if (Model.QuestionIndex > 1)
            {
                <input type="submit" value="Previous" name="submit" class="btn btn-info" />
            }

            @if (Model.QuestionIndex < Model.NumOfQuestion)
            {
                <button ng-hide="isTimeUp" type="submit" value="Next" name="submit" class="btn btn-primary">Next<span class="LeftMargin5 fa fa-chevron-right"></span></button>
                <input ng-show="isTimeUp" type="submit" value="See results" name="submit" class="orcaBtn btnWidth120 onTheLine" />
            }
            else
            {
                <input type="submit" value="Submit" name="submit" class="btn btn-success" />
            }

        </form>

    </div>
    <br />
</div>
