@model ManageTestQuestionsVM
<style>
    .buttons {
        display: flex;
        justify-content: center;
    }
</style>
<h1>Manage Test Questions</h1>
<h3>@Model.TestName</h3>
<p>@Model.Description</p>

<a asp-controller="Admin" asp-action="CreateQuestion" asp-route-TestId="@Model.TestId"><button class="orcaBtn BottomMargin20 btnWidth210"><span class="fa fa-plus rightMargin5"></span>Create New Question</button></a>
<a asp-controller="Admin" asp-action="Import" asp-route-TestId="@Model.TestId"><button class="orcaBtn BottomMargin20 btnWidth210"><span class="fa fa-download rightMargin5"></span>Import Questions</button></a>
<div>
    @foreach (var question in Model.Questions)
            {
        <div class="whiteSquare BottomMargin20" onclick="PartialPreview(@question.Id)">

            <div class="buttons rightFloat">
                <a asp-controller="Admin" asp-action="UpdateQuestion" asp-route-questionId="@question.Id" asp-route-testId="@Model.TestId">
                    <span class="fa fa-pencil green btnSpan orcaTool-tooltip" data-toggle="tooltip" title="Edit Question"></span>
                </a>
                <a asp-controller="Admin" asp-action="RemoveQuestion" asp-route-questionId="@question.Id" asp-route-testId="@Model.TestId">
                    <span class="fa fa-trash red btnSpan orcaTool-tooltip redT" data-toggle="tooltip" title="Delete Question"></span>
                </a>
                <span id="@("btnPreview"+question.Id)" class="fa fa-chevron-down orcaBlue btnSpan orcaTool-tooltip" data-toggle="tooltip" title="Show"></span>
            </div>

                @*<button id="@("toolTipID"+question.Id)" class="orcaTool-tooltip orcaBtn bgWhite orcaBlue btnWidth40" data-toggle="tooltip" title="Show">*@

            @(Html.Raw("<i>" + (question.QuestionText)?
                        .ToString().Replace("<video", "[INSERTED VIDEO]").Replace("<img", "[INSERTED IMAGE]").Replace("<iframe", "[FRAME]")
                        .Substring(0, Math.Min(Html.Raw(question.QuestionText).ToString().Length, 50)) + "...</i>"))

            <br />
            <br />

            <div id="@("detailsDiv"+question.Id)" hidden></div>
        </div>
    }
</div>
<!-- floatat knapparna till höger, bra? in i css isf. ändrat Go Back/save till endast Dashboard-->
<a href="~/Admin/Dashboard"><button class="orcaBtn btnWidth210 leftFloat"><span class="fa fa-chevron-left rightMargin5"></span>Return to Dashboard</button></a>

<script>
    function PartialPreview(id) {
        $.get("/Admin/PreviewQuestionPartial",
            { id: id },
            function (data) {
                var buttonPrevId = "#btnPreview" + id;
                var divId = "#detailsDiv" + id;

                $(divId).html("</br>" + data);
                $(divId).toggle();

                if ($(divId).is(":hidden")) {
                    $(buttonPrevId).removeClass("fa-chevron-up");
                    $(buttonPrevId).addClass("fa-chevron-down");

                    $(buttonPrevId).attr("title", "Show")
                        .tooltip("fixTitle")
                        .tooltip("hide");
                }
                else {
                    $(buttonPrevId).removeClass("fa-chevron-down");
                    $(buttonPrevId).addClass("fa-chevron-up");

                    $(buttonPrevId).attr("title", "Hide")
                        .tooltip("fixTitle")
                        .tooltip("hide");
                }
            });
    }
</script>
